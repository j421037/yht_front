webpackJsonp([3],{"4Vb0":function(e,t){},"9U48":function(e,t){},P1uI:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={props:{CategoryId:{type:Number,default:0},update:{type:Boolean,default:!1}},data:function(){return{Form:{id:"",name:""},Rules:{name:[{required:!0,trigger:"blur",message:"请输入分类名称"}]},submiting:!1}},methods:{handleOpen:function(){var e=this;if(this.update){var t=this.$store.state.user.ProductCategoryList.find(function(t){return t.id==e.CategoryId});this.Form.name=t.name,this.Form.id=t.id}},handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!1})},LoadProductCategory:function(){this.$store.dispatch("LoadProductCategory")},submit:function(){var e=this;this.$refs.form.validate(function(t){if(t){var i="ProductCategoryStore";e.update&&(i="ProductCategoryUpdate"),e.submiting=!0,e.$store.dispatch(i,e.Form).then(function(){"success"==e.$store.state.user.ProductCategoryStore.status?(e.$notify.success("操作成功"),e.LoadProductCategory(),e.handleClose(),e.$refs.form.resetFields()):e.$notify.error("操作失败"),e.submiting=!1})}})}},computed:{CreateVisible:function(){return this.$store.state.user.BaseProduct.Category.CreateCategoryDialog.visible},title:function(){return this.update&&this.CategoryId>0?"修改产品分类":"新增产品分类"}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"category-create_dialog"},[i("el-dialog",{attrs:{title:e.title,visible:e.CreateVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.CreateVisible=t},open:e.handleOpen}},[i("el-form",{ref:"form",attrs:{model:e.Form,rules:e.Rules,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"产品分类名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入分类名称"},model:{value:e.Form.name,callback:function(t){e.$set(e.Form,"name",t)},expression:"Form.name"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.submiting},on:{click:e.submit}},[e._v("提 交")])],1)],1)],1)},staticRenderFns:[]};var l=i("VU/8")(s,o,!1,function(e){i("tgpN")},"data-v-463123c2",null).exports,r={name:"CreatePriceTable",props:{CurrentCategoryId:{type:Number,default:0}},data:function(){return{Form:{category:"",brand:"",attribute:[{description:"",field:"",key:new Date}],method:"",table:""},Rules:{category:[{required:!0,trigger:"blur",message:"请选择一个分类"}],brand:[{required:!0,trigger:"blur",message:"请选择一个品牌"}],method:[{required:!0,trigger:"blur",message:"请选择计算方式"}],table:[{required:!0,trigger:"blur",message:"请输入表名称"}]},submiting:!1,prefix:"P_"}},methods:{handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreatePriceDialog.visible",value:!1})},addAttribute:function(){this.Form.attribute.push({description:"",field:"",key:new Date})},removeAttribute:function(e){var t=this;this.Form.attribute.some(function(i,s){if(i.key==e.key)return t.Form.attribute.splice(s,1),!0})},LoadPriceTable:function(e){this.$store.dispatch("LoadProductCategory")},handleChange:function(e){var t=this;this.CategoryList.some(function(i){i.id==e&&(t.prefix="P_"+i.abbr.toUpperCase()+"_")})},submit:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.submiting=!0,e.$store.dispatch("ProductCreatePriceTable",e.Form).then(function(){var t=e.$store.state.user.ProductCreatePriceTable;"success"==t.status?(e.$notify.success("操作成功"),e.handleClose(),e.$refs.form.resetFields(),e.LoadPriceTable(e.CurrentCategoryId)):e.$notify.error("操作失败,"+t.errmsg),e.submiting=!1}))})}},computed:{Visible:function(){return this.$store.state.user.BaseProduct.Category.CreatePriceDialog.visible},BrandList:function(){return this.$store.state.user.brandList},CategoryList:function(){return this.$store.state.user.ProductCategoryList},Methods:function(){return[{name:"面价打折",id:0},{name:"吨价下浮",id:1}]}}},n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"create-price-dialog"},[i("el-dialog",{attrs:{title:"创建价格表",visible:e.Visible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.Visible=t}}},[i("el-form",{ref:"form",staticClass:"create-price-dialog_form",attrs:{model:e.Form,rules:e.Rules,"label-width":"120px"}},[i("section",[i("p",{staticClass:"title"},[e._v("基础信息")])]),e._v(" "),i("el-form-item",{attrs:{prop:"category",label:"产品分类"}},[i("el-select",{attrs:{placeholder:"请选择分类"},on:{change:e.handleChange},model:{value:e.Form.category,callback:function(t){e.$set(e.Form,"category",t)},expression:"Form.category"}},e._l(e.CategoryList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{prop:"brand",label:"选择品牌"}},[i("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:e.Form.brand,callback:function(t){e.$set(e.Form,"brand",t)},expression:"Form.brand"}},e._l(e.BrandList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"价格计算方式",prop:"method"}},[i("el-select",{model:{value:e.Form.method,callback:function(t){e.$set(e.Form,"method",t)},expression:"Form.method"}},e._l(e.Methods,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"数据表名称",prop:"table"}},[i("el-input",{attrs:{placeholder:"表名称"},model:{value:e.Form.table,callback:function(t){e.$set(e.Form,"table",t)},expression:"Form.table"}},[i("template",{slot:"prepend"},[e._v(e._s(e.prefix))])],2)],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",loading:e.submiting},nativeOn:{click:function(t){return e.submit(t)}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var a=i("VU/8")(r,n,!1,function(e){i("9U48")},"data-v-61dddb04",null).exports,d={name:"ManagementDn",props:{tableId:{type:Number,default:0},category:{type:String,default:null},brand:{type:String,default:null}},data:function(){return{dns:[],form:{table_id:null,spec:null},formRules:{spec:[{required:!0,trigger:"blur",message:"请输入规格名称"}]},isIndeterminate:!0,checkAll:!1,errmsg:null,responseMsg:null,responseType:null,showResponse:!1}},computed:{Visible:function(){return this.$store.state.user.DialogVisible.managementDn},items:function(){return this.$store.state.user.ProductSpecs},deleteDisable:function(){return!(this.dns.length>0)},checkBoxShow:function(){return this.items.length>0}},methods:{handleClose:function(){this.$store.dispatch("DialogVisible",{managementDn:!1})},handleOpen:function(){this.tableId?(this.form.table_id=this.tableId,this.errmsg=null,this.LoadDns()):this.errmsg="参数不完整，请重新打开",this.dns=[]},LoadDns:function(){this.dns=[],this.checkAll=!1,this.isIndeterminate=!0,this.$store.dispatch("ProductSpecAll",{table_id:this.tableId})},handleCheckAllChange:function(e){var t=[];this.items.forEach(function(e){t.push(e.label)}),this.dns=e?t:[],this.isIndeterminate=!1},handleCheckedDnsChange:function(e){var t=e.length;this.checkAll=t===this.items.length,this.isIndeterminate=t>0&&t<this.items.length},AddItem:function(){var e=this;this.$refs.form.validate(function(t){t&&e.form.table_id&&e.$store.dispatch("ProductSpecAdd",e.form).then(function(t){"success"==t.status?(e.showMsg(t.status,"操作成功"),e.$refs.form.resetFields(),e.LoadDns()):e.showMsg("error",t.errmsg)})})},showMsg:function(e,t){var i=this;this.showResponse=!0,this.responseType=e,this.responseMsg=t,setTimeout(function(){i.showResponse=!1},2500)},deleteDn:function(){var e=this;if(this.dns.length<1)return!1;var t=[];if(this.dns.forEach(function(i){var s=e.items.find(function(e){return e.label==i});s&&void 0!==s&&t.push(s.value)}),t.length>0){var i=t.join(",");this.$store.dispatch("ProductSpecDelete",{id:i}).then(function(t){"success"==t.status?(e.showMsg(t.status,"操作成功"),e.LoadDns()):e.showMsg("error",t.errmsg)})}}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-management-dn"},[i("el-dialog",{attrs:{title:"规格管理",visible:e.Visible,width:"35%","before-close":e.handleClose},on:{"update:visible":function(t){e.Visible=t},open:e.handleOpen}},[e.errmsg?i("el-alert",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"error",title:e.errmsg}}):e._e(),e._v(" "),i("el-alert",{attrs:{closable:!1,type:"info"}},[i("p",{staticStyle:{"font-weight":"bold"}},[i("span",[e._v("分类：")]),e._v(" "),i("em",[e._v(e._s(e.category))])]),e._v(" "),i("p",{staticStyle:{"font-weight":"bold"}},[i("span",[e._v("品牌：")]),e._v(" "),i("em",[e._v(e._s(e.brand))])])]),e._v(" "),i("el-form",{ref:"form",staticStyle:{"margin-top":"10px"},attrs:{model:e.form,"label-width":"80px",rules:e.formRules}},[i("el-form-item",{attrs:{prop:"spec",label:"规格(DN)"}},[i("el-input",{model:{value:e.form.spec,callback:function(t){e.$set(e.form,"spec",t)},expression:"form.spec"}},[i("template",{slot:"append"},[i("el-button",{nativeOn:{click:function(t){return e.AddItem(t)}}},[e._v("添加")])],1)],2)],1)],1),e._v(" "),i("transition",{attrs:{name:"el-zoom-in-top"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.showResponse,expression:"showResponse"}],staticStyle:{"text-align":"center",transition:"all 0.3s"}},[i("span",{staticStyle:{display:"block",width:"50%",margin:"0 auto"}},[i("el-alert",{attrs:{type:e.responseType,"show-icon":""}},[e._v(e._s(e.responseMsg))])],1)])]),e._v(" "),i("p",{staticStyle:{transition:"all 0.3s"}},[i("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")])],1),e._v(" "),e.checkBoxShow?i("transition",{attrs:{name:"el-zoom-in-top"}},[i("el-checkbox-group",{on:{change:e.handleCheckedDnsChange},model:{value:e.dns,callback:function(t){e.dns=t},expression:"dns"}},e._l(e.items,function(e,t){return i("el-checkbox",{key:t,attrs:{label:e.label,value:e.value}})}))],1):e._e(),e._v(" "),i("p",[i("el-button",{attrs:{type:"primary",disabled:e.deleteDisable},nativeOn:{click:function(t){return e.deleteDn(t)}}},[e._v("删除")])],1)],1)],1)},staticRenderFns:[]};var u=i("VU/8")(d,c,!1,function(e){i("4Vb0")},null,null).exports,p=i("mvHQ"),m=i.n(p),f=i("woOf"),b=i.n(f),h={name:"manageField",props:{category:{type:String,default:null},brand:{type:String,default:null},tableId:{type:Number,default:0},tables:{type:Array,default:[]}},data:function(){return{errmsg:null,response:{show:!1},AppendFieldVisible:!1,AppendFieldForm:{id:null,field:null,description:null,oldField:null,type:null},AppendFieldRules:{field:[{required:!0,trigger:"blur",message:"字段名必须填写"},{validator:this.onlyEnAndNum,trigger:"blur"}],description:[{required:!0,trigger:"blur",message:"显示名必须填写"}],type:[{required:!0,trigger:"blur",message:"请选择字段类型"}]},AppentSubmiting:!1,update:!1,defaultForm:{},CFieldString:0,ListVisible:!1,ListForm:{key:null,value:null,field:null,tableId:null},ListFormRules:{key:[{required:!0,trigger:"blur",message:"请输入名称"}],value:[{required:!0,trigger:"blur",message:"请输入值"}]},ListFormBtnLoding:!1,ListResponse:{show:!1,msg:null},ListItems:[],CurrentListItemId:null,SortForm:{field:null,sort:"asc"},SortFormRules:{field:[{required:!0,trigger:"blur",message:"请选择字段"}]},SortDialogVisible:!1,SortMethod:[{label:"正序",value:"asc"},{label:"倒叙",value:"desc"}],SortSubmiting:!1,SortResponse:{show:!1,status:"success",msg:null},FieldAllocationDialogVisible:!1,AllocationSubmiting:!1,AllocationForm:{targetTableId:null,sourceField:null},AllocationRules:{tableId:[{required:!0,trigger:"blur",message:"请选择要分配的目标"}]},AllocationResponse:{status:"success",show:!1,msg:null}}},computed:{AppendFieldTitle:function(){return this.update?"修改字段":"添加字段"},CurrentSort:function(){var e=this,t=this.fields.find(function(t){return t.field==e.table.orderby}),i=this.SortMethod.find(function(t){return t.value==e.table.sort});return t&&i?{orderBy:t.description,sort:i.label}:null},visible:function(){return this.$store.state.user.DialogVisible.managementField},table:function(){var e=this.$store.state.user.SinglePriceTable;return console.log(e),e.length>0?(this.SortForm.field=e[0].orderby,this.SortForm.sort=e[0].sort,e[0]):{}},fields:function(){return void 0!==this.table.field?this.table.field:[]},fieldLength:function(){return this.fields.length},fieldTypes:function(){return this.$store.state.user.ProductTableFieldType}},created:function(){this.defaultForm=b()({},this.AppendFieldForm)},methods:{ListTableIndexMethod:function(e){return++e},ListHandleClose:function(){this.ListVisible=!1},ListHandleOpen:function(e){this.ListVisible=!0,this.ListForm.field=e,this.LoadListItem(e)},LoadListItem:function(e){var t=this;this.ListItems=[],this.$store.dispatch("LoadProductTableSelectItem",{tableId:this.tableId,field:e}).then(function(e){"success"==e.status&&(t.ListItems=e.data)})},AppendListItem:function(){var e=this;this.$refs.ListForm.validate(function(t){if(!t)return!1;e.ListFormBtnLoding=!0,e.$store.dispatch("AppendProductTableSelectItem",e.ListForm).then(function(t){"success"==t.status?(e.ListResponse.msg="操作成功",e.LoadListItem(e.ListForm.field),e.$refs.ListForm.resetFields()):e.ListResponse.msg=t.errmsg,e.ListResponse.show=!0,e.ListFormBtnLoding=!1,setTimeout(function(){e.ListResponse.show=!1},1500)})})},DeleteListItem:function(e){var t=this;this.CurrentListItemId=e,this.$store.dispatch("DeleteProductTableSelectItem",{id:e}).then(function(e){t.CurrentListItemId=null,console.log(e),"success"==e.status?(t.ListResponse.msg="操作成功",t.LoadListItem(t.ListForm.field)):t.ListResponse.msg=e.errmsg,setTimeout(function(){t.ListResponse.show=!1},1500)})},findTypeName:function(e){if(this.fieldTypes.length>0){var t=this.fieldTypes.find(function(t){return t.value==e});if(void 0!==t)return t.label}return null},handleClose:function(){this.$store.dispatch("DialogVisible",{managementField:!1})},handleOpen:function(){if(this.tableId<0)return this.errmsg="参数不完整",!1;this.errmsg=null,this.ListForm.tableId=this.AppendFieldForm.id=this.tableId,this.LoadPriceSingleTable(this.tableId)},EidtField:function(e){this.update=!0,this.AppendFieldVisible=!0,this.AppendFieldForm.field=this.AppendFieldForm.oldField=e.field,this.AppendFieldForm.description=e.description,this.AppendFieldForm.type=e.type},changeFieldIndex:function(e,t){var i=this,s={tableId:this.tableId,field:e.field,direction:t};this.$store.dispatch("ChangeFieldIndex",s).then(function(e){console.log(e),"success"==e.status&&i.LoadPriceSingleTable(i.tableId)})},DeleteField:function(e){var t=this;this.CFieldString=e.field,this.$store.dispatch("DeleteTableField",{id:this.tableId,field:e.field}).then(function(e){console.log(e),"success"==e.status?(t.response.status="success",t.response.msg="操作成功",t.LoadPriceSingleTable()):(t.response.status="error",t.response.msg=e.errmsg),t.response.show=!0,setTimeout(function(){t.response.show=!1},1500)}),this.CFieldString=null},handleAppendFieldClose:function(){this.update=!1,this.AppendFieldVisible=!1},LoadPriceSingleTable:function(){this.$store.dispatch("LoadSinglePriceTable",{id:this.tableId})},submit:function(){var e=this;this.$refs.AppendFieldForm.validate(function(t){if(!t)return!1;e.submiting=!0;var i="AppendTableField";e.update&&(i="ModifyTableField"),e.$store.dispatch(i,e.AppendFieldForm).then(function(t){console.log(t),"success"==t.status?(e.response.status="success",e.response.msg="操作成功",e.$refs.AppendFieldForm.resetFields(),e.LoadPriceSingleTable()):(e.response.status="error",e.response.msg=t.errmsg),e.response.show=!0,setTimeout(function(){e.response.show=!1,e.AppendFieldVisible=!1},1e3)})})},OpenAppendForm:function(){this.AppendFieldVisible=!0,this.AppendFieldForm=JSON.parse(m()(this.defaultForm)),this.AppendFieldForm.id=this.tableId},SortFormSubmit:function(){var e=this;this.$refs.SortForm.validate(function(t){if(!t)return!1;var i=b()({},e.SortForm);i.table_id=e.tableId,e.$store.dispatch("ProductTableSort",i).then(function(t){"success"==t.status?(e.SortResponse.status="success",e.SortResponse.msg="操作成功",e.LoadPriceSingleTable()):(e.SortResponse.status="error",e.SortResponse.msg=t.errmsg),e.SortResponse.show=!0,setTimeout(function(){e.SortResponse.show=!1,e.SortDialogVisible=!1},1500)})})},allocation:function(e){this.FieldAllocationDialogVisible=!0,this.AllocationForm.sourceField=e},AllocationFormSubmit:function(){var e=this;this.$refs.AllocationForm.validate(function(t){if(!t)return!1;e.AllocationSubmiting=!0;var i=b()({},e.AllocationForm);i.sourceTableId=e.tableId,e.$store.dispatch("AllcationField",i).then(function(t){console.log(t),"success"==t.status?(e.AllocationResponse.status="success",e.AllocationResponse.msg="操作成功"):(e.AllocationResponse.status="error",e.AllocationResponse.msg=t.errmsg),e.AllocationResponse.show=!0,e.AllocationSubmiting=!1,setTimeout(function(){e.AllocationResponse.show=!1,e.FieldAllocationDialogVisible=!1},1500)})})},onlyEnAndNum:function(e,t,i){/^[A-Za-z][A-Za-z0-9_]*$/.test(t)?i():i(new Error("字段名必须是字母开头,然后只能包含字母数字下划线"))}}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"dialog-management-field"},[i("el-dialog",{attrs:{title:"字段管理",visible:e.visible,width:"45%","before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t},open:e.handleOpen}},[e.errmsg?i("el-alert",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"error",title:e.errmsg}}):e._e(),e._v(" "),i("el-alert",{attrs:{closable:!1,type:"info"}},[i("p",{staticStyle:{"font-weight":"bold"}},[i("span",[e._v("分类：")]),e._v(" "),i("em",[e._v(e._s(e.category))])]),e._v(" "),i("p",{staticStyle:{"font-weight":"bold"}},[i("span",[e._v("品牌：")]),e._v(" "),i("em",[e._v(e._s(e.brand))])]),e._v(" "),i("p",{staticStyle:{"font-weight":"bold"}},[i("span",[e._v("排序：")]),e._v(" "),e.CurrentSort?i("em",[e._v("按 "+e._s(e.CurrentSort.orderBy)+" 的 "+e._s(e.CurrentSort.sort)+" 进行排序")]):i("em",[e._v("无")])])]),e._v(" "),i("el-table",{staticStyle:{"margin-top":"8px"},attrs:{data:e.fields,border:"",height:"250px","default-sort":{prop:"index",order:"ascending"}}},[i("el-table-column",{attrs:{label:"#",prop:"index",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{label:"字段名",prop:"field"}}),e._v(" "),i("el-table-column",{attrs:{label:"显示名",prop:"description"}}),e._v(" "),i("el-table-column",{attrs:{label:"类型"}},[i("el-table-column",{attrs:{label:"键"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.findTypeName(t.row.type))+"\n                    ")]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"值",prop:"type"}})],1),e._v(" "),i("el-table-column",{attrs:{label:"属性"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.default?i("span",[e._v("系统生成")]):i("span",[e._v("手动添加")])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"表头排序",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"success",size:"mini",disabled:t.row.index<1},nativeOn:{click:function(i){e.changeFieldIndex(t.row,"up")}}},[e._v("上移")]),e._v(" "),i("el-button",{attrs:{type:"info",size:"mini",disabled:e.fieldLength-1==t.row.index},nativeOn:{click:function(i){e.changeFieldIndex(t.row,"down")}}},[e._v("下移")])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.default?e._e():[i("el-button",{attrs:{type:"text"},nativeOn:{click:function(i){e.EidtField(t.row)}}},[e._v("修改")]),e._v(" "),i("el-button",{attrs:{type:"text",disabled:e.CFieldString==t.row.field},nativeOn:{click:function(i){e.DeleteField(t.row)}}},[e._v("删除")]),e._v(" "),"select"==t.row.type?i("el-button",{attrs:{type:"text"},nativeOn:{click:function(i){e.ListHandleOpen(t.row.field)}}},[e._v("列表项")]):e._e(),e._v(" "),"select"==t.row.type?i("el-button",{attrs:{type:"text"},nativeOn:{click:function(i){e.allocation(t.row.field)}}},[e._v("分配")]):e._e()]]}}])})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info"},on:{click:function(t){e.SortDialogVisible=!0}}},[e._v("列表排序")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.OpenAppendForm}},[e._v("添加字段")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:e.AppendFieldTitle,visible:e.AppendFieldVisible,width:"30%","before-close":e.handleAppendFieldClose},on:{"update:visible":function(t){e.AppendFieldVisible=t}}},[i("el-form",{ref:"AppendFieldForm",attrs:{model:e.AppendFieldForm,rules:e.AppendFieldRules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"字段名称",prop:"field"}},[i("el-input",{attrs:{placeholder:"字段名，只能是字母、数字、下划线"},model:{value:e.AppendFieldForm.field,callback:function(t){e.$set(e.AppendFieldForm,"field",t)},expression:"AppendFieldForm.field"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"显示名称",prop:"description"}},[i("el-input",{attrs:{placeholder:"产品的属性名称"},model:{value:e.AppendFieldForm.description,callback:function(t){e.$set(e.AppendFieldForm,"description",t)},expression:"AppendFieldForm.description"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"类型名称",prop:"type"}},[i("el-select",{model:{value:e.AppendFieldForm.type,callback:function(t){e.$set(e.AppendFieldForm,"type",t)},expression:"AppendFieldForm.type"}},e._l(e.fieldTypes,function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),i("transition",{attrs:{name:"el-zoom-in-top"}},[e.response.show?i("el-alert",{attrs:{type:e.response.status}},[e._v(e._s(e.response.msg))]):e._e()],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",loading:e.AppentSubmiting},nativeOn:{click:function(t){return e.submit(t)}}},[e._v("提  交")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"列表项设置",visible:e.ListVisible,width:"35%","before-close":e.ListHandleClose},on:{"update:visible":function(t){e.ListVisible=t}}},[i("div",{staticClass:"list-items_container"},[i("el-alert",{attrs:{type:"success"}},[e._v("名称和值可以一样")]),e._v(" "),i("el-form",{ref:"ListForm",staticClass:"list-items_form",staticStyle:{"margin-top":"5px"},attrs:{model:e.ListForm,inline:!0,rules:e.ListFormRules}},[i("el-form-item",{attrs:{label:"名称",prop:"key"}},[i("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.ListForm.key,callback:function(t){e.$set(e.ListForm,"key",t)},expression:"ListForm.key"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"值",prop:"value"}},[i("el-input",{attrs:{placeholder:"请输入值"},model:{value:e.ListForm.value,callback:function(t){e.$set(e.ListForm,"value",t)},expression:"ListForm.value"}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{size:"mini",loading:e.ListFormBtnLoding,type:"primary"},nativeOn:{click:function(t){return e.AppendListItem(t)}}},[e._v("提交")])],1)],1),e._v(" "),i("el-table",{attrs:{data:e.ListItems,border:"",height:"250"}},[i("el-table-column",{attrs:{type:"index",index:e.ListTableIndexMethod,width:"50"}}),e._v(" "),i("el-table-column",{attrs:{label:"名称",prop:"key"}}),e._v(" "),i("el-table-column",{attrs:{label:"值",prop:"value"}}),e._v(" "),i("el-table-column",{attrs:{label:"其他"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",disabled:e.CurrentListItemId==t.row.id},nativeOn:{click:function(i){e.DeleteListItem(t.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),i("transition",{attrs:{name:"el-zoom-in-top"}},[i("p",{directives:[{name:"show",rawName:"v-show",value:e.ListResponse.show,expression:"ListResponse.show"}],staticStyle:{"text-align":"center"}},[e._v(e._s(e.ListResponse.msg))])])],1)]),e._v(" "),i("el-dialog",{attrs:{title:"排序设置",visible:e.SortDialogVisible,width:"30%"},on:{"update:visible":function(t){e.SortDialogVisible=t}}},[i("el-form",{ref:"SortForm",attrs:{model:e.SortForm,"label-width":"80px",rules:e.SortFormRules}},[i("el-form-item",{attrs:{label:"字段",prop:"field"}},[i("el-select",{model:{value:e.SortForm.field,callback:function(t){e.$set(e.SortForm,"field",t)},expression:"SortForm.field"}},e._l(e.fields,function(e,t){return i("el-option",{key:t,attrs:{label:e.description,value:e.field}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"排序方式"}},[i("el-select",{model:{value:e.SortForm.sort,callback:function(t){e.$set(e.SortForm,"sort",t)},expression:"SortForm.sort"}},e._l(e.SortMethod,function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),i("el-alert",{attrs:{type:"warning",closable:!1}},[e._v("正序：例如1-9， 倒叙： 9-1 反着来")]),e._v(" "),i("transition",{attrs:{name:"el-zoom-in"}},[i("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.SortResponse.show,expression:"SortResponse.show"}],staticStyle:{"margin-top":"5px"},attrs:{type:e.SortResponse.status}},[e._v(e._s(e.SortResponse.msg))])],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",loading:e.SortSubmiting},nativeOn:{click:function(t){return e.SortFormSubmit(t)}}},[e._v("保 存")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"字段分配",visible:e.FieldAllocationDialogVisible,width:"30%"},on:{"update:visible":function(t){e.FieldAllocationDialogVisible=t}}},[i("el-form",{ref:"AllocationForm",attrs:{model:e.AllocationForm,rules:e.AllocationRules}},[i("el-form-item",{attrs:{label:"分配到: "}},[i("el-select",{model:{value:e.AllocationForm.targetTableId,callback:function(t){e.$set(e.AllocationForm,"targetTableId",t)},expression:"AllocationForm.targetTableId"}},e._l(e.tables,function(t,s){return t.id!=e.tableId?i("el-option",{key:t.key,attrs:{label:t.name,value:t.id}}):e._e()}))],1)],1),e._v(" "),e.AllocationResponse.show?i("el-alert",{attrs:{type:e.AllocationResponse.status,closable:!1}},[e._v(e._s(e.AllocationResponse.msg))]):e._e(),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",loading:e.AllocationSubmiting},nativeOn:{click:function(t){return e.AllocationFormSubmit(t)}}},[e._v("分 配")])],1)],1)],1)},staticRenderFns:[]};var v={data:function(){return{CurrentCid:0,DelBtnDisable:!0,DelBtnLoading:!1,TableIds:[],CategoryUpdate:!1,DnDialogVisible:!1,tableId:null,brandName:"",mangementVisible:!1}},created:function(){this.$store.dispatch("brandList"),this.$store.dispatch("LoadProductCategory"),this.$store.dispatch("LoadProductTableFieldType")},methods:{CategoryRowStyle:function(e){var t=e.row,i=(e.rowIndex,{cursor:"pointer"});return t.id==this.CurrentCid&&(i.background="#f0f9eb"),i},CategoryRowClick:function(e){this.CurrentCid!=e.id&&(this.CurrentCid=e.id,this.LoadProductPriceTable(e.id))},OpenCreateCategoryDialog:function(){this.CategoryUpdate=!1,this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!0})},OpenCreatePriceDialog:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreatePriceDialog.visible",value:!0})},OpenEditCategoryDialog:function(){this.CategoryUpdate=!0,this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!0})},LoadProductPriceTable:function(e){},RemoveTables:function(){var e=this;if(this.TableIds.length<1)return!1;this.DelBtnLoading=!0,this.$store.dispatch("DeleteProductPriceTable",{id:this.TableIds}).then(function(){var t=e.$store.state.user.DeleteProductPriceTable;"success"==t.status?(e.$notify.success("删除成功"),e.$store.dispatch("LoadProductCategory")):e.$notify.error("删除失败,"+t.errmsg),e.DelBtnLoading=!1})},handleSelectionChange:function(e){var t=this;this.TableIds=[],e.forEach(function(e){t.TableIds.push(e.id)}),this.TableIds.length>0?this.DelBtnDisable=!1:this.DelBtnDisable=!0},ManagementDN:function(e){this.prepareDialogShow(e),this.$store.dispatch("DialogVisible",{managementDn:!0})},ManagementField:function(e){this.prepareDialogShow(e),this.$store.dispatch("DialogVisible",{managementField:!0})},prepareDialogShow:function(e){this.tableId=e;var t=this.TableList.find(function(t){return e==t.id});this.brandName=t.name}},computed:{category:function(){var e=this.$store.state.user.ProductCategoryList;return e.length>0&&(this.CurrentCid=e[0].id),e},TableList:function(){var e=this,t=this.$store.state.user.ProductCategoryList,i=[];return t.length>0?(t.forEach(function(t){t.id==e.CurrentCid&&(i=t.children)}),console.log(i),i):[]},brand:function(){var e=this,t=[];return this.brands.forEach(function(i){i.cid==e.CurrentCid&&t.push(i)}),t},categoryName:function(){var e=this;if(this.CurrentCid>0)return this.category.find(function(t){return t.id==e.CurrentCid}).name}},components:{"createcategory-dialog":l,"createprice-dialog":a,"managedn-dialog":u,"managefield-dialog":i("VU/8")(h,g,!1,function(e){i("yItP")},null,null).exports}},y={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"base-products-wallpaper"},[i("div",{staticClass:"products-box"},[i("div",{staticClass:"products-box_category"},[i("div",{staticClass:"category_header"},[i("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.OpenCreateCategoryDialog(t)}}},[e._v("新增分类")]),e._v(" "),i("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.OpenEditCategoryDialog(t)}}},[e._v("编辑分类")]),e._v(" "),i("el-button",{attrs:{type:"text"}},[e._v("删除分类")]),e._v(" "),i("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.OpenCreatePriceDialog(t)}}},[e._v("创建价格表")])],1),e._v(" "),i("div",{staticClass:"category_list"},e._l(e.category,function(t,s){return i("div",{key:s,staticClass:"category-item",class:{"category-item-active":t.id==e.CurrentCid},on:{click:function(i){e.CategoryRowClick(t)}}},[e._v("\n                    "+e._s(t.name)+"\n                ")])}))]),e._v(" "),i("div",{staticClass:"products-box_brand"},[i("el-table",{attrs:{data:e.TableList,border:""},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"品牌名称"}}),e._v(" "),i("el-table-column",{attrs:{prop:"method_l",label:"计算方式"}}),e._v(" "),i("el-table-column",{attrs:{prop:"table",label:"对应的数据表"}}),e._v(" "),i("el-table-column",{attrs:{prop:"fields.description",label:"字段信息"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"warning",size:"mini"},nativeOn:{click:function(i){e.ManagementField(t.row.id)}}},[e._v("字段管理")])]}}])})],1),e._v(" "),i("p",[i("el-button",{attrs:{type:"info",disabled:e.DelBtnDisable,loading:e.DelBtnLoading},nativeOn:{click:function(t){return e.RemoveTables(t)}}},[e._v("删除")])],1)],1)]),e._v(" "),i("createcategory-dialog",{attrs:{CategoryId:e.CurrentCid,update:e.CategoryUpdate}}),e._v(" "),i("createprice-dialog",{attrs:{CurrentCategoryId:e.CurrentCid}}),e._v(" "),i("managedn-dialog",{attrs:{tableId:e.tableId,category:e.categoryName,brand:e.brandName}}),e._v(" "),i("managefield-dialog",{attrs:{tableId:e.tableId,category:e.categoryName,brand:e.brandName,tables:e.TableList}})],1)},staticRenderFns:[]};var _=i("VU/8")(v,y,!1,function(e){i("nwbJ")},"data-v-3e502356",null);t.default=_.exports},nwbJ:function(e,t){},tgpN:function(e,t){},yItP:function(e,t){}});