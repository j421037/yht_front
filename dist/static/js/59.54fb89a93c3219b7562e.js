webpackJsonp([59],{BBLX:function(e,t){},amXW:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("mvHQ"),o=r.n(i),a=r("woOf"),s=r.n(a),l={data:function(){return{Form:{category:"",brand:"",date:"",version_str:"",rows:[],fileid:[],remark:"",freight:0},submiting:!1,FieldMap:{},defaultField:{},fileList:[],defaultForm:{},Mappings:[],RowRules:[]}},created:function(){this.defaultForm=s()({},this.Form)},methods:{handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Price.PriceMaintenance.visible",value:!1})},resetForm:function(){this.Form=JSON.parse(o()(this.defaultForm)),this.fileList=[],this.$refs.form.clearValidate()},handleOpen:function(){},HandleCategoryChange:function(){this.Form.brand=""},HandleBrandChange:function(e){var t=this,r=[];this.defaultField={},this.brands.forEach(function(t){t.value==e&&(r=t.mapping)}),r.forEach(function(e){t.defaultField[e.key]=""}),this.Form.rows=[],this.Form.rows.push(JSON.parse(o()(this.defaultField))),this.Mappings=r;var i=this.makeRule();r.forEach(function(e){var r={};r[e.key]=i,t.RowRules.push(r)})},makeRule:function(){return[{required:!0,trigger:"blur",message:"请选择或输入内容"}]},UploadSuccess:function(e,t){"success"==e.status&&this.Form.fileid.push({id:e.id,uid:t.uid})},BeforeUpload:function(e){this.fileList.push(e)},BeforeRemove:function(e,t){var r=this;return this.Form.fileid.forEach(function(t,i){t.uid==e.uid&&r.Form.fileid.splice(i,1)}),!0},submit:function(){var e=this;this.$refs.form.validate(function(t){t&&e.$store.dispatch("ProductPriceUpdate",e.Form).then(function(){"success"==e.$store.state.user.ProductPriceUpdate.status?(e.$notify.success("操作成功"),e.$store.dispatch("ProductSurfacePriceList",{id:e.Form.brand}),e.handleClose()):e.$notify.error("操作失败")})})},validateField:function(e,t,r){console.log(e),/^[1-9]+(\.?\d+){0,1}$/.test(t)?r():r(new Error("请输入数字"))},validateVersion:function(e,t,r){/^[A-Za-z0-9_\.]*$/.test(t)?r():r(new Error("只允许输入字母、数字、下划线（ _ ）"))},validateNotNull:function(e,t,r){console.log(t),null!=t&&""!=t?r():r(new Error("请选择或输入内容"))},AddItem:function(){this.Form.rows.push(JSON.parse(o()(this.defaultField)))},RemoveItem:function(e){this.Form.rows.splice(e,1)}},computed:{visible:function(){return this.$store.state.user.BaseProduct.Price.PriceMaintenance.visible},UploadUrl:function(){return this.$appConst.FILE_UPLOAD_URL+"?token="+this.$tool.getter("token")},categorys:function(){var e=[];return this.$store.state.user.ProductCategoryList.forEach(function(t){e.push({label:t.name,value:t.id})}),e},brands:function(){var e=this,t=[],r=[];return this.$store.state.user.ProductCategoryList.forEach(function(t){t.id==e.Form.category&&(r=t.children)}),console.log(r),r.forEach(function(e){t.push({label:e.name,value:e.id,mapping:e.fields.mapping})}),t},AddItemStatus:function(){return!(this.Form.rows.length>0)}}},n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"maintenance-dialog"},[r("el-dialog",{attrs:{title:"价格维护",visible:e.visible,"before-close":e.handleClose,width:"48%"},on:{"update:visible":function(t){e.visible=t},open:e.handleOpen}},[r("el-form",{ref:"form",staticClass:"price-form",attrs:{model:e.Form,"label-width":"80px"}},[r("div",{staticClass:"form-add-item"},[r("el-form-item",{attrs:{label:"产品分类",prop:"category",rules:{required:!0,trigger:"blur",message:"请选择分类"}}},[r("el-select",{on:{change:e.HandleCategoryChange},model:{value:e.Form.category,callback:function(t){e.$set(e.Form,"category",t)},expression:"Form.category"}},e._l(e.categorys,function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"品牌",prop:"brand",rules:{required:!0,trigger:"blur",message:"请选择品牌"}}},[r("el-select",{on:{change:e.HandleBrandChange},model:{value:e.Form.brand,callback:function(t){e.$set(e.Form,"brand",t)},expression:"Form.brand"}},e._l(e.brands,function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),r("div",{staticClass:"form-add-item-freight"},[r("el-form-item",{attrs:{label:"运费",prop:"freight",rules:{required:!0,trigger:"blur",message:"请输入运费，默认0"}}},[r("el-input",{attrs:{placeholder:"运费，如包运费请输入0"},model:{value:e.Form.freight,callback:function(t){e.$set(e.Form,"freight",t)},expression:"Form.freight"}},[r("template",{slot:"append"},[e._v("元")])],2)],1)],1),e._v(" "),r("div",{staticClass:"form-add-item"},[r("el-form-item",{attrs:{label:"日期",prop:"date",rules:{required:!0,trigger:"blur",message:"请选择日期"}}},[r("el-date-picker",{attrs:{align:"right",type:"date",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.Form.date,callback:function(t){e.$set(e.Form,"date",t)},expression:"Form.date"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"版本号","label-width":"80px",prop:"version_str",rules:[{validator:e.validateVersion,trigger:"blur"},{required:!0,trigger:"blur",message:"请输入价格版本"}]}},[r("el-input",{attrs:{placeholder:"价格版本"},model:{value:e.Form.version_str,callback:function(t){e.$set(e.Form,"version_str",t)},expression:"Form.version_str"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"备注信息",prop:"remark",rules:{required:"true",trigger:"blur",message:"请输入调价备注"}}},[r("el-input",{attrs:{placeholder:"请输入备注信息"},model:{value:e.Form.remark,callback:function(t){e.$set(e.Form,"remark",t)},expression:"Form.remark"}})],1),e._v(" "),r("p",{staticStyle:{height:"1px","border-top":"1px solid #ebebeb"}}),e._v(" "),r("el-upload",{attrs:{action:e.UploadUrl,multiple:"",name:"uploadfile","on-success":e.UploadSuccess,"before-upload":e.BeforeUpload,"before-remove":e.BeforeRemove}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("添加厂家价格文件")]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传图片、PDF、和office文件")])],1),e._v(" "),r("p",{staticStyle:{height:"1px","border-top":"1px solid #ebebeb"}}),e._v(" "),r("div",{staticClass:"form-add-price-list"},e._l(e.Form.rows,function(t,i){return r("div",{key:i,staticClass:"form-add-price-item"},[r("span",{staticStyle:{height:"32px",display:"flex","align-items":"center"}},[e._v(e._s(i+1)+"、")]),e._v(" "),e._l(e.Mappings,function(t,o){return r("el-form-item",{key:o,attrs:{label:t.value}},["select"!=t.type?r("el-input",{model:{value:e.Form.rows[i][t.key],callback:function(r){e.$set(e.Form.rows[i],t.key,r)},expression:"Form.rows[k][mp.key]"}}):r("el-select",{model:{value:e.Form.rows[i][t.key],callback:function(r){e.$set(e.Form.rows[i],t.key,r)},expression:"Form.rows[k][mp.key]"}},e._l(t.options,function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)}),e._v(" "),r("span",{staticClass:"delete-btn"},[r("el-button",{staticStyle:{height:"32px",width:"32px",display:"flex","justify-content":"center"},attrs:{type:"info",icon:"el-icon-delete",size:"mini",title:"删除"},nativeOn:{click:function(t){e.RemoveItem(i)}}})],1)],2)})),e._v(" "),r("p",{staticStyle:{margin:"0","text-align":"center"}},[r("el-button",{attrs:{type:"info",disabled:e.AddItemStatus},nativeOn:{click:function(t){return e.AddItem(t)}}},[e._v("增加规格")])],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.resetForm}},[e._v("重 置")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.submiting},nativeOn:{click:function(t){return e.submit(t)}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var u=r("VU/8")(l,n,!1,function(e){r("BBLX")},null,null);t.default=u.exports}});