webpackJsonp([55],{"G5/o":function(e,t,r){r("uqUo")("getOwnPropertyNames",function(){return r("Rrel").f})},PHPr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("aFK5"),o=r.n(a),n=r("woOf"),l=r.n(n),i={name:"DesignFormula",props:{tableId:{type:Number},formulaId:{type:Number,default:0},update:{type:Boolean,default:!1}},data:function(){return{AppendFormulaForm:[],refreshStatus:!0,errmsg:null,loading:!1}},computed:{AppendFormulaDialog:function(){return this.$store.state.user.DialogVisible.designFormula},AppendFormulaFormTostring:function(){var e="";for(var t in this.AppendFormulaForm)e+=" "+this.AppendFormulaForm[t].value;return e},CanAppendNumeric:function(){return this.AppendFormulaForm.length>0&&"numeric"==this.AppendFormulaForm[this.AppendFormulaForm.length-1].type},FormmulaParams:function(){return this.$store.state.user.SignTableParam}},methods:{DialogOpen:function(){var e=this;this.tableId>0&&this.$store.dispatch("LoadSignTableParam",{tableId:this.tableId}),this.formulaId>0&&this.update&&(this.loading=!0,this.$store.dispatch("LoadFormula",{id:this.formulaId}).then(function(t){"success"==t.status&&(e.AppendFormulaForm=t.data,console.log(e.AppendFormulaForm)),e.loading=!1}))},DialogClose:function(){this.$store.dispatch("DialogVisible",{designFormula:!1})},FormulaFormParamChanged:function(){this.errmsg=null},FormulaClearAll:function(){this.AppendFormulaForm=[],this.errmsg=null},RemoveLast:function(){this.AppendFormulaForm.pop()},FormulaAddField:function(e){this.AppendFormulaForm.push({type:e,value:""})},SaveFormula:function(){var e=this,t=[],r=0,a=[],n=this.FormmulaParams;this.AppendFormulaForm.forEach(function(e){a.push(l()({},e))}),a.map(function(e){var t=n.find(function(t){return t.value==e.value});return t&&(e.type=t.type),e});var i=a.every(function(a){if("("==a.value&&++r,")"==a.value&&--r,o()(t).length>0){if("operator"==t.type&&"operator"==a.type)return e.errmsg="不能连续使用两个运算符",t=a,!1;if("field"==t.type&&"field"==a.type)return e.errmsg="不能连续使用两个字段",t=a,!1;if("operator"==t.type&&")"==a.valud)return e.errmsg='运算符后面不能接括号 ")"',t=a,!1;if("("==t.value&&"operator"==a.type)return e.errmsg="运算符前面不能使用括号",t=a,!1;if("("==t.value&&")"==a.value)return e.errmsg="不能连续使用两个括号",t=a,!1;if(")"==t.value&&"field"==a.type)return e.errmsg="右括号后不可以连接字段",t=a,!1}else if("operator"==a.type)return e.errmsg="请检查符号的合法性",t=a,!1;if("numeric"==a.type){if(""==a.value)return e.errmsg="输入框内容不能为空",!1;if(o()(t).length>0&&("field"==t.type||")"==t.value))return e.errmsg="输入内容之前不能是字段和右括号",!1}return t=a,!0});if(0!=r&&1==i&&(this.errmsg="请检查括号的合法性",i=!1),console.log(a),i){var u="AppendFormula";this.update&&(u="UpdateFormula"),this.$store.dispatch(u,{params:a,tableId:this.tableId}).then(function(e){console.log(e)})}}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"设计公式",visible:e.AppendFormulaDialog,"before-close":e.DialogClose,width:"40%"},on:{"update:visible":function(t){e.AppendFormulaDialog=t},open:e.DialogOpen}},[r("div",{staticClass:"AppendFormulaDialog_body"},[r("div",{staticClass:"formula-container"},[r("div",{staticClass:"add-param"},[r("el-button",{attrs:{size:"mini",type:"info"},nativeOn:{click:function(t){e.FormulaAddField("field")}}},[e._v("增加操作符或字段")]),e._v(" "),r("el-button",{attrs:{size:"mini",type:"info",disabled:e.CanAppendNumeric},nativeOn:{click:function(t){e.FormulaAddField("numeric")}}},[e._v("增加数值")])],1),e._v(" "),e.refreshStatus?r("p",[e._v(e._s(e.AppendFormulaFormTostring))]):e._e(),e._v(" "),r("p",{staticClass:"errmsg",staticStyle:{"font-size":"12px",color:"red"}},[e._v(e._s(e.errmsg))]),e._v(" "),r("el-form",{staticClass:"FormulaForm",attrs:{inline:!0}},e._l(e.AppendFormulaForm,function(t,a){return r("el-form-item",{key:a},["field"==t.type?r("el-select",{on:{change:e.FormulaFormParamChanged},model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"item.value"}},e._l(e.FormmulaParams,function(e,t){return r("el-option",{key:t,attrs:{label:e.label,value:e.value}})})):r("el-input",{model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"item.value"}})],1)}))],1)]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.FormulaClearAll}},[e._v("清 空")]),e._v(" "),r("el-button",{on:{click:e.RemoveLast}},[e._v("撤销上一步")]),e._v(" "),r("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.SaveFormula(t)}}},[e._v("保 存")])],1)])},staticRenderFns:[]};var s=r("VU/8")(i,u,!1,function(e){r("ha45")},null,null);t.default=s.exports},aFK5:function(e,t,r){e.exports={default:r("gAsd"),__esModule:!0}},gAsd:function(e,t,r){r("G5/o");var a=r("FeBl").Object;e.exports=function(e){return a.getOwnPropertyNames(e)}},ha45:function(e,t){}});