webpackJsonp([6],{P1uI:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={props:{CategoryId:{type:Number,default:0},update:{type:Boolean,default:!1}},data:function(){return{Form:{id:"",name:""},Rules:{name:[{required:!0,trigger:"blur",message:"请输入分类名称"}]},submiting:!1}},methods:{handleOpen:function(){var t=this;if(this.update){var e=this.$store.state.user.ProductCategoryList.find(function(e){return e.id==t.CategoryId});this.Form.name=e.name,this.Form.id=e.id}},handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!1})},LoadProductCategory:function(){this.$store.dispatch("LoadProductCategory")},submit:function(){var t=this;this.$refs.form.validate(function(e){if(e){var r="ProductCategoryStore";t.update&&(r="ProductCategoryUpdate"),t.submiting=!0,t.$store.dispatch(r,t.Form).then(function(){"success"==t.$store.state.user.ProductCategoryStore.status?(t.$notify.success("操作成功"),t.LoadProductCategory(),t.handleClose(),t.$refs.form.resetFields()):t.$notify.error("操作失败"),t.submiting=!1})}})}},computed:{CreateVisible:function(){return this.$store.state.user.BaseProduct.Category.CreateCategoryDialog.visible},title:function(){return this.update&&this.CategoryId>0?"修改产品分类":"新增产品分类"}}},a={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"category-create_dialog"},[r("el-dialog",{attrs:{title:t.title,visible:t.CreateVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.CreateVisible=e},open:t.handleOpen}},[r("el-form",{ref:"form",attrs:{model:t.Form,rules:t.Rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"产品分类名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入分类名称"},model:{value:t.Form.name,callback:function(e){t.$set(t.Form,"name",e)},expression:"Form.name"}})],1)],1),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v("提 交")])],1)],1)],1)},staticRenderFns:[]};var o=r("VU/8")(i,a,!1,function(t){r("tgpN")},"data-v-463123c2",null).exports,s={name:"CreatePriceTable",props:{CurrentCategoryId:{type:Number,default:0}},data:function(){return{Form:{category:"",brand:"",attribute:[{description:"",field:"",key:new Date}],method:"",table:""},Rules:{category:[{required:!0,trigger:"blur",message:"请选择一个分类"}],brand:[{required:!0,trigger:"blur",message:"请选择一个品牌"}],method:[{required:!0,trigger:"blur",message:"请选择计算方式"}],table:[{required:!0,trigger:"blur",message:"请输入表名称"}]},submiting:!1,prefix:"P_"}},methods:{handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreatePriceDialog.visible",value:!1})},addAttribute:function(){this.Form.attribute.push({description:"",field:"",key:new Date})},removeAttribute:function(t){var e=this;this.Form.attribute.some(function(r,i){if(r.key==t.key)return e.Form.attribute.splice(i,1),!0})},LoadPriceTable:function(t){this.$store.dispatch("LoadProductCategory")},handleChange:function(t){var e=this;this.CategoryList.some(function(r){r.id==t&&(e.prefix="P_"+r.abbr.toUpperCase()+"_")})},submit:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.submiting=!0,t.$store.dispatch("ProductCreatePriceTable",t.Form).then(function(){var e=t.$store.state.user.ProductCreatePriceTable;"success"==e.status?(t.$notify.success("操作成功"),t.handleClose(),t.$refs.form.resetFields(),t.LoadPriceTable(t.CurrentCategoryId)):t.$notify.error("操作失败,"+e.errmsg),t.submiting=!1}))})}},computed:{Visible:function(){return this.$store.state.user.BaseProduct.Category.CreatePriceDialog.visible},BrandList:function(){return this.$store.state.user.brandList},CategoryList:function(){return this.$store.state.user.ProductCategoryList},Methods:function(){return[{name:"面价打折",id:0},{name:"吨价下浮",id:1}]}}},n={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"create-price-dialog"},[r("el-dialog",{attrs:{title:"创建价格表",visible:t.Visible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.Visible=e}}},[r("el-form",{ref:"form",staticClass:"create-price-dialog_form",attrs:{model:t.Form,rules:t.Rules,"label-width":"120px"}},[r("section",[r("p",{staticClass:"title"},[t._v("基础信息")])]),t._v(" "),r("el-form-item",{attrs:{prop:"category",label:"产品分类"}},[r("el-select",{attrs:{placeholder:"请选择分类"},on:{change:t.handleChange},model:{value:t.Form.category,callback:function(e){t.$set(t.Form,"category",e)},expression:"Form.category"}},t._l(t.CategoryList,function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),r("el-form-item",{attrs:{prop:"brand",label:"选择品牌"}},[r("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:t.Form.brand,callback:function(e){t.$set(t.Form,"brand",e)},expression:"Form.brand"}},t._l(t.BrandList,function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),r("el-form-item",{attrs:{label:"价格计算方式",prop:"method"}},[r("el-select",{model:{value:t.Form.method,callback:function(e){t.$set(t.Form,"method",e)},expression:"Form.method"}},t._l(t.Methods,function(t,e){return r("el-option",{key:e,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),r("el-form-item",{attrs:{label:"数据表名称",prop:"table"}},[r("el-input",{attrs:{placeholder:"表名称"},model:{value:t.Form.table,callback:function(e){t.$set(t.Form,"table",e)},expression:"Form.table"}},[r("template",{slot:"prepend"},[t._v(t._s(t.prefix))])],2)],1),t._v(" "),r("section",[r("p",{staticClass:"title"},[t._v("产品属性")])]),t._v(" "),t._l(t.Form.attribute,function(e,i){return r("div",{staticClass:"horizontal-item"},[r("el-form-item",{attrs:{label:"描述","label-width":"80px",rules:{required:!0,trigger:"blur",message:"请输入描述"}}},[r("el-input",{model:{value:e.description,callback:function(r){t.$set(e,"description",r)},expression:"item.description"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"字段名","label-width":"100px",rules:{required:!0,trigger:"blur",message:"请输入字段名"}}},[r("el-input",{model:{value:e.field,callback:function(r){t.$set(e,"field",r)},expression:"item.field"}})],1),t._v(" "),r("el-button",{staticStyle:{width:"32px",height:"32px","margin-left":"10px",display:"flex","justify-content":"center"},attrs:{type:"info",icon:"el-icon-delete",title:"删除"},nativeOn:{click:function(r){t.removeAttribute(e)}}})],1)}),t._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("el-button",{attrs:{type:"success",size:"mini"},nativeOn:{click:function(e){return t.addAttribute(e)}}},[t._v("增加属性")])],1)],2),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),t._v(" "),r("el-button",{attrs:{type:"primary",loading:t.submiting},nativeOn:{click:function(e){return t.submit(e)}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l={data:function(){return{CurrentCid:0,DelBtnDisable:!0,DelBtnLoading:!1,TableIds:[],CategoryUpdate:!1}},created:function(){this.$store.dispatch("brandList"),this.$store.dispatch("LoadProductCategory")},methods:{CategoryRowStyle:function(t){var e=t.row,r=(t.rowIndex,{cursor:"pointer"});return e.id==this.CurrentCid&&(r.background="#f0f9eb"),r},CategoryRowClick:function(t){this.CurrentCid!=t.id&&(this.CurrentCid=t.id,this.LoadProductPriceTable(t.id))},OpenCreateCategoryDialog:function(){this.CategoryUpdate=!1,this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!0})},OpenCreatePriceDialog:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreatePriceDialog.visible",value:!0})},OpenEditCategoryDialog:function(){this.CategoryUpdate=!0,this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!0})},LoadProductPriceTable:function(t){},RemoveTables:function(){var t=this;if(this.TableIds.length<1)return!1;this.DelBtnLoading=!0,this.$store.dispatch("DeleteProductPriceTable",{id:this.TableIds}).then(function(){var e=t.$store.state.user.DeleteProductPriceTable;"success"==e.status?(t.$notify.success("删除成功"),t.$store.dispatch("LoadProductCategory")):t.$notify.error("删除失败,"+e.errmsg),t.DelBtnLoading=!1})},handleSelectionChange:function(t){var e=this;this.TableIds=[],t.forEach(function(t){e.TableIds.push(t.id)}),this.TableIds.length>0?this.DelBtnDisable=!1:this.DelBtnDisable=!0}},computed:{category:function(){var t=this.$store.state.user.ProductCategoryList;return t.length>0&&(this.CurrentCid=t[0].id),t},TableList:function(){var t=this,e=this.$store.state.user.ProductCategoryList,r=[];if(e.length>0)return e.forEach(function(e){e.id==t.CurrentCid&&(r=e.children)}),r},brand:function(){var t=this,e=[];return this.brands.forEach(function(r){r.cid==t.CurrentCid&&e.push(r)}),e}},components:{"createcategory-dialog":o,"createprice-dialog":r("VU/8")(s,n,!1,function(t){r("tTyT")},"data-v-3d404c2f",null).exports}},c={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"base-products-wallpaper"},[r("div",{staticClass:"products-box"},[r("div",{staticClass:"products-box_category"},[r("div",{staticClass:"category_header"},[r("el-button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.OpenCreateCategoryDialog(e)}}},[t._v("新增分类")]),t._v(" "),r("el-button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.OpenEditCategoryDialog(e)}}},[t._v("编辑分类")]),t._v(" "),r("el-button",{attrs:{type:"text"}},[t._v("删除分类")]),t._v(" "),r("el-button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.OpenCreatePriceDialog(e)}}},[t._v("创建价格表")])],1),t._v(" "),r("div",{staticClass:"category_list"},t._l(t.category,function(e,i){return r("div",{key:i,staticClass:"category-item",class:{"category-item-active":e.id==t.CurrentCid},on:{click:function(r){t.CategoryRowClick(e)}}},[t._v("\n                    "+t._s(e.name)+"\n                ")])}))]),t._v(" "),r("div",{staticClass:"products-box_brand"},[r("el-table",{attrs:{data:t.TableList,border:""},on:{"selection-change":t.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),r("el-table-column",{attrs:{prop:"name",label:"品牌名称"}}),t._v(" "),r("el-table-column",{attrs:{prop:"method_l",label:"计算方式"}}),t._v(" "),r("el-table-column",{attrs:{prop:"table",label:"对应的数据表"}}),t._v(" "),r("el-table-column",{attrs:{prop:"fields.description",label:"字段信息"}})],1),t._v(" "),r("p",[r("el-button",{attrs:{type:"info",disabled:t.DelBtnDisable,loading:t.DelBtnLoading},nativeOn:{click:function(e){return t.RemoveTables(e)}}},[t._v("删除")])],1)],1)]),t._v(" "),r("createcategory-dialog",{attrs:{CategoryId:t.CurrentCid,update:t.CategoryUpdate}}),t._v(" "),r("createprice-dialog",{attrs:{CurrentCategoryId:t.CurrentCid}})],1)},staticRenderFns:[]};var u=r("VU/8")(l,c,!1,function(t){r("dPk3")},"data-v-ffd7db56",null);e.default=u.exports},dPk3:function(t,e){},tTyT:function(t,e){},tgpN:function(t,e){}});