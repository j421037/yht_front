webpackJsonp([53],{"2SsV":function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t("xFrp"),a={render:function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"makeoffer-wallpaper"},[t("el-dialog",{attrs:{title:"开始报价",visible:e.visible,"before-close":e.handleClose,width:"30%"},on:{"update:visible":function(r){e.visible=r},open:e.handleOpen}},[t("el-form",{ref:"form",attrs:{model:e.Form,rules:e.Rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"客户名称",prop:"customer_id",error:e.AuthorizeMsg}},[t("el-select",{attrs:{remote:"",filterable:"","remote-method":e.remoteMethod,loading:e.RemoteLoading},on:{change:e.handleCustSelect},model:{value:e.Form.customer_id,callback:function(r){e.$set(e.Form,"customer_id",r)},expression:"Form.customer_id"}},e._l(e.customers,function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})})),e._v(" "),e.AuthorizeMsg?t("el-button",{attrs:{type:"success",size:"mini"}},[e._v("申请授权")]):e._e()],1),e._v(" "),t("el-form-item",{attrs:{label:"选择分类",prop:"category"}},[t("el-select",{on:{change:e.CategoryChange},model:{value:e.Form.category,callback:function(r){e.$set(e.Form,"category",r)},expression:"Form.category"}},e._l(e.categorys,function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"选择品牌",prop:"product_brand_id"}},[t("el-select",{on:{change:e.BrandChange},model:{value:e.Form.product_brand_id,callback:function(r){e.$set(e.Form,"product_brand_id",r)},expression:"Form.product_brand_id"}},e._l(e.brands,function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"服务人员",prop:"serviceor_id"}},[t("el-select",{model:{value:e.Form.serviceor_id,callback:function(r){e.$set(e.Form,"serviceor_id",r)},expression:"Form.serviceor_id"}},e._l(e.users,function(e,r){return t("el-option",{key:r,attrs:{label:e,value:r}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"价格版本",prop:"version_id"}},[t("el-select",{model:{value:e.Form.version_id,callback:function(r){e.$set(e.Form,"version_id",r)},expression:"Form.version_id"}},e._l(e.versions,function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"计算公式",prop:"operate"}},[t("div",{staticStyle:{display:"flex"}},[t("el-input",{staticStyle:{flex:"1"},attrs:{value:"价格",disabled:!0,placeholder:"请输入数字"}}),e._v(" "),t("el-select",{staticStyle:{margin:"0 5px",flex:"1"},model:{value:e.Form.operate,callback:function(r){e.$set(e.Form,"operate",r)},expression:"Form.operate"}},e._l(e.operates,function(e,r){return t("el-option",{key:r,attrs:{label:e.label,value:e.value}})})),e._v(" "),t("el-form-item",{staticStyle:{margin:"0",flex:"2"},attrs:{prop:"operate_val"}},[t("el-input",{attrs:{placeholder:"请输入数字"},model:{value:e.Form.operate_val,callback:function(r){e.$set(e.Form,"operate_val",r)},expression:"Form.operate_val"}},[1==e.mode?t("template",{slot:"append"},[e._v("元")]):e._e(),e._v(" "),0==e.mode?t("template",{slot:"append"},[e._v("百分点")]):e._e()],2)],1)],1)]),e._v(" "),e.visible?t("el-form-item",{attrs:{label:"选择规格",prop:"products"}},[t("el-tree",{attrs:{data:e.treeData,"show-checkbox":"","node-key":"id","default-expanded-keys":["0"]},on:{check:e.handleCheck}})],1):e._e()],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.submiting},nativeOn:{click:function(r){return e.submit(r)}}},[e._v("提 交")])],1)],1)],1)},staticRenderFns:[]};var l=function(e){t("5kH+")},i=t("VU/8")(o.a,a,!1,l,null,null);r.default=i.exports},"5kH+":function(e,r){},xFrp:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={name:"MakeOffer",data:function(){return{Form:{customer_id:"",products:[],category:"",product_brand_id:"",operate:1,serviceor_id:"",operate_val:"",version_id:""},Rules:{customer_id:[{required:!0,trigger:"blur",message:"请选择客户"}],products:[{required:!0,trigger:"blur",message:"请选择产品规格"}],category:[{required:!0,trigger:"blur",message:"请选择分类"}],product_brand_id:[{required:!0,trigger:"blur",message:"请选择品牌"}],operate:[{required:!0,trigger:"blur"}],operate_val:[{validator:this.validateField,trigger:"blur"}],serviceor_id:[{required:!0,trigger:"blur",message:"请选择服务人员"}],version_id:[{required:!0,trigger:"blur",message:"请选择价格版本"}]},operates:[{label:"x",value:1},{label:"÷",value:2},{label:"+",value:3},{label:"-",value:4}],RemoteLoading:!1,submiting:!1,defaultField:{},FieldMap:{},AuthorizeMsg:"",mode:0}},created:function(){this.$store.dispatch("MakeOfferParams")},methods:{handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Price.MakeOffer.visible",value:!1})},handleOpen:function(){},handleCheck:function handleCheck(data,checked){if(checked.checkedKeys.length>0){var checks=checked.checkedKeys;for(var i in"0"==checks[0]&&checks.splice(0,1),checks)checks[i]=eval("("+checks[i]+")");this.Form.products=checks}},remoteMethod:function(e){console.log(e)},submit:function(){var e=this;this.$refs.form.validate(function(r){r&&e.$store.dispatch("CreateOffer",e.Form).then(function(){var r=e.$store.state.user.CreateOffer;"success"==r.status?(e.$notify.success("创建成功！请到历史报价下载报价文件"),e.$refs.form.resetFields(),e.handleClose()):e.$notify.error("操作失败,"+r.errmsg)})})},CategoryChange:function(){this.Form.product_brand_id="",this.Form.products=[]},BrandChange:function(e){var r=this;this.brands.forEach(function(t){e==t.value&&(r.mode=t.mode)})},validateField:function(e,r,t){/^[1-9]+(\.?\d+){0,1}$/.test(r)?t():t(new Error("请输入数字"))},handleCustSelect:function(e){var r=this;this.customers.forEach(function(t){t.value==e&&(t.authorize?r.AuthorizeMsg="":r.AuthorizeMsg="你没有对该客户报价的权限，请申请授权")})}},computed:{visible:function(){return this.$store.state.user.BaseProduct.Price.MakeOffer.visible},customers:function(){return[{label:"江苏华建",value:1,authorize:!0},{label:"北京建工",value:2,authorize:!1}]},categorys:function(){return this.$store.state.user.MakeOfferParams},brands:function(){var e=this,r=[];return this.categorys.forEach(function(t){t.value==e.Form.category&&(r=t.childrens)}),r},treeData:function(){var e=this;if(this.brands&&this.Form.product_brand_id){var r=[],t=[{label:"全部",id:"0",children:[]}],o={};if(this.brands.forEach(function(t){t.value==e.Form.product_brand_id&&(r=t.products,o=t.field_map)}),r)return r.forEach(function(e){var r={label:[],id:"{"};for(var a in e)r.label.push(o[a]+"("+e[a]+")"),r.id+=a+":"+e[a]+",";r.label=r.label.join("、"),r.id=r.id.substring(0,r.id.length-1),r.id+="}",t[0].children.push(r)}),t[0].children.length>0?t:[]}},users:function(){return this.$store.state.user.CostRole.users},versions:function(){var e=this,r=[];return this.brands.forEach(function(t){t.value==e.Form.product_brand_id&&(r=t.versions)}),r}}}}});