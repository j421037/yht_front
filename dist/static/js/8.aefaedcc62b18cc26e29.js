webpackJsonp([8],{"0CRc":function(e,t){},G8kU:function(e,t){},P1uI:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"category-create_dialog"},[r("el-dialog",{attrs:{title:"新增产品分类",visible:e.CreateVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.CreateVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.Form,rules:e.Rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"产品分类名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入分类名称"},model:{value:e.Form.name,callback:function(t){e.$set(e.Form,"name",t)},expression:"Form.name"}})],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.submiting},on:{click:e.submit}},[e._v("提 交")])],1)],1)],1)},staticRenderFns:[]};var a=r("VU/8")({data:function(){return{Form:{name:""},Rules:{name:[{required:!0,trigger:"blur",message:"请输入分类名称"}]},submiting:!1}},methods:{handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!1})},LoadProductCategory:function(){this.$store.dispatch("LoadProductCategory")},submit:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.submiting=!0,e.$store.dispatch("ProductCategoryStore",e.Form).then(function(){"success"==e.$store.state.user.ProductCategoryStore.status?(e.$notify.success("操作成功"),e.LoadProductCategory(),e.handleClose(),e.$refs.form.resetFields()):e.$notify.error("操作失败"),e.submiting=!1}))})}},computed:{CreateVisible:function(){return this.$store.state.user.BaseProduct.Category.CreateCategoryDialog.visible}}},i,!1,function(e){r("0CRc")},"data-v-492a5ab4",null).exports,o={name:"CreatePriceTable",props:{CurrentCategoryId:{type:Number,default:0}},data:function(){return{Form:{category:"",brand:"",attribute:[{description:"",field:"",key:new Date}],method:"",table:""},Rules:{category:[{required:!0,trigger:"blur",message:"请选择一个分类"}],brand:[{required:!0,trigger:"blur",message:"请选择一个品牌"}],method:[{required:!0,trigger:"blur",message:"请选择计算方式"}],table:[{required:!0,trigger:"blur",message:"请输入表名称"}]},submiting:!1,prefix:"P_"}},methods:{handleClose:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreatePriceDialog.visible",value:!1})},addAttribute:function(){this.Form.attribute.push({description:"",field:"",key:new Date})},removeAttribute:function(e){var t=this;this.Form.attribute.some(function(r,i){if(r.key==e.key)return t.Form.attribute.splice(i,1),!0})},LoadPriceTable:function(e){this.$store.dispatch("LoadProductPriceTable",{category:e})},handleChange:function(e){var t=this;this.CategoryList.some(function(r){r.id==e&&(t.prefix="P_"+r.abbr.toUpperCase()+"_")})},submit:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.submiting=!0,e.$store.dispatch("ProductCreatePriceTable",e.Form).then(function(){var t=e.$store.state.user.ProductCreatePriceTable;"success"==t.status?(e.$notify.success("操作成功"),e.LoadPriceTable(),e.handleClose(),e.$refs.form.resetFields(),e.LoadPriceTable(e.CurrentCategoryId)):e.$notify.error("操作失败,"+t.errmsg),e.submiting=!1}))})}},computed:{Visible:function(){return this.$store.state.user.BaseProduct.Category.CreatePriceDialog.visible},BrandList:function(){return this.$store.state.user.brandList},CategoryList:function(){return this.$store.state.user.ProductCategoryList},Methods:function(){return[{name:"面价打折",id:0},{name:"吨价下浮",id:1}]}}},s={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"create-price-dialog"},[r("el-dialog",{attrs:{title:"创建价格表",visible:e.Visible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.Visible=t}}},[r("el-form",{ref:"form",staticClass:"create-price-dialog_form",attrs:{model:e.Form,rules:e.Rules,"label-width":"120px"}},[r("section",[r("p",{staticClass:"title"},[e._v("基础信息")])]),e._v(" "),r("el-form-item",{attrs:{prop:"category",label:"产品分类"}},[r("el-select",{attrs:{placeholder:"请选择分类"},on:{change:e.handleChange},model:{value:e.Form.category,callback:function(t){e.$set(e.Form,"category",t)},expression:"Form.category"}},e._l(e.CategoryList,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{prop:"brand",label:"选择品牌"}},[r("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:e.Form.brand,callback:function(t){e.$set(e.Form,"brand",t)},expression:"Form.brand"}},e._l(e.BrandList,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"价格计算方式",prop:"method"}},[r("el-select",{model:{value:e.Form.method,callback:function(t){e.$set(e.Form,"method",t)},expression:"Form.method"}},e._l(e.Methods,function(e,t){return r("el-option",{key:t,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"数据表名称",prop:"table"}},[r("el-input",{attrs:{placeholder:"表名称"},model:{value:e.Form.table,callback:function(t){e.$set(e.Form,"table",t)},expression:"Form.table"}},[r("template",{slot:"prepend"},[e._v(e._s(e.prefix))])],2)],1),e._v(" "),r("section",[r("p",{staticClass:"title"},[e._v("产品属性")])]),e._v(" "),e._l(e.Form.attribute,function(t,i){return r("div",{staticClass:"horizontal-item"},[r("el-form-item",{attrs:{label:"描述","label-width":"80px",rules:{required:!0,trigger:"blur",message:"请输入描述"}}},[r("el-input",{model:{value:t.description,callback:function(r){e.$set(t,"description",r)},expression:"item.description"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"字段名","label-width":"100px",rules:{required:!0,trigger:"blur",message:"请输入字段名"}}},[r("el-input",{model:{value:t.field,callback:function(r){e.$set(t,"field",r)},expression:"item.field"}})],1),e._v(" "),r("el-button",{staticStyle:{width:"32px",height:"32px","margin-left":"10px",display:"flex","justify-content":"center"},attrs:{type:"info",icon:"el-icon-delete",title:"删除"},nativeOn:{click:function(r){e.removeAttribute(t)}}})],1)}),e._v(" "),r("p",{staticStyle:{"text-align":"center"}},[r("el-button",{attrs:{type:"success",size:"mini"},nativeOn:{click:function(t){return e.addAttribute(t)}}},[e._v("增加属性")])],1)],2),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.submiting},nativeOn:{click:function(t){return e.submit(t)}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var n={data:function(){return{CurrentCid:0,DelBtnDisable:!0,DelBtnLoading:!1,TableIds:[]}},created:function(){this.$store.dispatch("brandList"),this.$store.dispatch("LoadProductCategory")},methods:{CategoryRowStyle:function(e){var t=e.row,r=(e.rowIndex,{cursor:"pointer"});return t.id==this.CurrentCid&&(r.background="#f0f9eb"),r},CategoryRowClick:function(e){this.CurrentCid!=e.id&&(this.CurrentCid=e.id,this.LoadProductPriceTable(e.id))},OpenCreateCategoryDialog:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreateCategoryDialog.visible",value:!0})},OpenCreatePriceDialog:function(){this.$store.dispatch("SetBaseProductConfig",{field:"Category.CreatePriceDialog.visible",value:!0})},LoadProductPriceTable:function(e){this.$store.dispatch("LoadProductPriceTable",{category:e})},RemoveTables:function(){var e=this;if(this.TableIds.length<1)return!1;this.DelBtnLoading=!0,this.$store.dispatch("DeleteProductPriceTable",{id:this.TableIds}).then(function(){var t=e.$store.state.user.DeleteProductPriceTable;"success"==t.status?(e.$notify.success("删除成功"),e.LoadProductPriceTable(e.CurrentCid)):e.$notify.error("删除失败,"+t.errmsg),e.DelBtnLoading=!1})},handleSelectionChange:function(e){var t=this;this.TableIds=[],e.forEach(function(e){t.TableIds.push(e.id)}),this.TableIds.length>0?this.DelBtnDisable=!1:this.DelBtnDisable=!0}},computed:{category:function(){var e=this.$store.state.user.ProductCategoryList;return e.length>0&&(this.CurrentCid=e[0].id),e},TableList:function(){var e=this,t=this.$store.state.user.ProductCategoryList,r=[];if(t.length>0)return t.forEach(function(t){t.id==e.CurrentCid&&(r=t.children)}),r},brand:function(){var e=this,t=[];return this.brands.forEach(function(r){r.cid==e.CurrentCid&&t.push(r)}),t}},components:{"createcategory-dialog":a,"createprice-dialog":r("VU/8")(o,s,!1,function(e){r("G8kU")},"data-v-03922548",null).exports}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"base-products-wallpaper"},[r("div",{staticClass:"products-box"},[r("div",{staticClass:"products-box_category"},[r("div",{staticClass:"category_header"},[r("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.OpenCreateCategoryDialog(t)}}},[e._v("新增分类")]),e._v(" "),r("el-button",{attrs:{type:"text"}},[e._v("编辑分类")]),e._v(" "),r("el-button",{attrs:{type:"text"}},[e._v("删除分类")]),e._v(" "),r("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.OpenCreatePriceDialog(t)}}},[e._v("创建价格表")])],1),e._v(" "),r("div",{staticClass:"category_list"},e._l(e.category,function(t,i){return r("div",{key:i,staticClass:"category-item",class:{"category-item-active":t.id==e.CurrentCid},on:{click:function(r){e.CategoryRowClick(t)}}},[e._v("\n                    "+e._s(t.name)+"\n                ")])}))]),e._v(" "),r("div",{staticClass:"products-box_brand"},[r("el-table",{attrs:{data:e.TableList,border:""},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{prop:"name",label:"品牌名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"method_l",label:"计算方式"}}),e._v(" "),r("el-table-column",{attrs:{prop:"table",label:"对应的数据表"}}),e._v(" "),r("el-table-column",{attrs:{prop:"fields.description",label:"字段信息"}})],1),e._v(" "),r("p",[r("el-button",{attrs:{type:"info",disabled:e.DelBtnDisable,loading:e.DelBtnLoading},nativeOn:{click:function(t){return e.RemoveTables(t)}}},[e._v("删除")])],1)],1)]),e._v(" "),r("createcategory-dialog"),e._v(" "),r("createprice-dialog",{attrs:{CurrentCategoryId:e.CurrentCid}})],1)},staticRenderFns:[]};var c=r("VU/8")(n,l,!1,function(e){r("cENH")},"data-v-3319955c",null);t.default=c.exports},cENH:function(e,t){}});